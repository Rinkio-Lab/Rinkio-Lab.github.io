<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¤–é“¾è·³è½¬æé†’</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        body.dark-theme {
            background-color: #222;
            color: #eee;
        }

        .container {
            background: inherit;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        body.dark-theme .container {
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }

        h1 {
            color: inherit;
            margin-bottom: 20px;
        }

        body.dark-theme h1 {
            color: #ddd;
        }

        p {
            margin-bottom: 15px;
            color: inherit;
        }

        #targetUrl {
            color: #0066cc;
            font-weight: bold;
        }

        body.dark-theme #targetUrl {
            color: #6cc0ff;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        #confirmBtn {
            background-color: #0066cc;
            color: white;
        }

        #confirmBtn:hover {
            background-color: #0055aa;
        }

        #cancelBtn {
            background-color: #ccc;
            color: #333;
        }

        #cancelBtn:hover {
            background-color: #bbb;
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="extraContent"></div>

        <h1>å³å°†è·³è½¬åˆ°å¤–éƒ¨é“¾æ¥</h1>
        <p>æ‚¨å³å°†è®¿é—®çš„é“¾æ¥æ˜¯ï¼š<span id="targetUrl">http://XXXX</span></p>
        <p>è¯¥é“¾æ¥å¯èƒ½åŒ…å«ä¸å®‰å…¨å†…å®¹ï¼Œè¯·è°¨æ…æ“ä½œã€‚</p>
        <div class="buttons">
            <button id="confirmBtn">ç»§ç»­è®¿é—®</button>
            <button id="cancelBtn">è¿”å›</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // ===== å¤–é“¾è·³è½¬åŠŸèƒ½ =====
            const urlParams = new URLSearchParams(window.location.search);
            const targetUrl = urlParams.get('target');
            const debugMode = urlParams.get('debug') === 'true';
            const currentDomain = window.location.hostname;

            // åŒ¹é…å†…ç½‘åŸŸåæˆ– IP
            const isInternalDomain = /(^127\.0\.0\.1$|^(10|172\.16|192\.168)\.|^localhost$)/;

            if (targetUrl) {
                let fixedUrl = targetUrl;
                if (!/^https?:\/\//.test(targetUrl)) {
                    fixedUrl = 'http://' + targetUrl;
                }

                try {
                    const targetHostname = new URL(fixedUrl).hostname;
                    const isInternal = isInternalDomain.test(targetHostname);
                    const currentTopLevel = currentDomain.split('.').slice(-2).join('.');
                    const targetTopLevel = targetHostname.split('.').slice(-2).join('.');
                    const isSameTopLevel = currentTopLevel === targetTopLevel;

                    const easterEggs = [
                        {
                            pattern: /\.google\.com(\.|$)/,
                            title: 'å³å°†å‰å¾€ Google åŸŸå',
                            message: 'è¯¥é“¾æ¥å¯èƒ½ã€ä¹Ÿè®¸ã€å¤§æ¦‚ç‡ä¸ä¼šä¸å®‰å…¨ï¼Œè¯·æ”¾å¿ƒè®¿é—®å§~',
                            extraHTML: '<img src="https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_92x30dp.png" alt="Google Logo" style="margin-bottom: 10px;">'
                        },
                        {
                            pattern: /\.youtube\.com(\.|$)/,
                            title: 'ğŸ¬ å³å°†å‰å¾€ YouTube åŸŸå',
                            message: 'å‡†å¤‡å¥½æ¢ç´¢è§†é¢‘å®‡å®™äº†å—ï¼Ÿ',
                            extraHTML: '<img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_Logo_2017.svg" alt="YouTube" style="width: 120px; margin-bottom: 10px;">'
                        },
                        {
                            pattern: /girls-band-cry\.com(\.|$)/,
                            title: 'GIRLS BAND CRY',
                            message: 'æ„¤æ€’ä¹Ÿå¥½å–œæ‚¦ä¹Ÿå¥½æ‚²ä¼¤ä¹Ÿå¥½ï¼ŒæŠŠä¸€åˆ‡éƒ½å€¾æ³¨è¿›å»ã€‚ â€”â€”GIRLS BAND CRY<br><br>ä½ è¯´å¾—å¯¹ï¼Œä½†æ˜¯ã€Šå°‘å¥³ä¹é˜Ÿçš„å‘å–Šã€‹ï¼ˆæ—¥è¯­ï¼šã‚¬ãƒ¼ãƒ«ã‚ºãƒãƒ³ãƒ‰ã‚¯ãƒ©ã‚¤ï¼‰æ˜¯ä¸œæ˜ åŠ¨ç”»åˆ¶ä½œï¼Œé…’äº•å’Œç”·æ‰§å¯¼çš„2024å¹´åŸåˆ›æ—¥æœ¬ç”µè§†åŠ¨ç”»......',
                            extraHTML: '<img src="https://upload.wikimedia.org/wikipedia/commons/5/5b/Girls_Band_Cry_logo.png" alt="GIRLS BAND CRY" style="width: 80%; margin-bottom: 10px; background-color: #fff; padding: 10px; border-radius: 8px;">'
                        }
                    ];

                    let customTitle = 'å³å°†è·³è½¬åˆ°å¤–éƒ¨é“¾æ¥';
                    let customMessage = 'è¯¥é“¾æ¥å¯èƒ½åŒ…å«ä¸å®‰å…¨å†…å®¹ï¼Œè¯·è°¨æ…æ“ä½œã€‚';
                    let customExtraHTML = '';

                    for (const egg of easterEggs) {
                        if (egg.pattern.test(targetHostname)) {
                            customTitle = egg.title;
                            customMessage = egg.message;
                            customExtraHTML = egg.extraHTML || '';
                            break;
                        }
                    }

                    if (!debugMode && (isInternal || isSameTopLevel)) {
                        window.location.href = fixedUrl;
                        return;
                    }

                    document.getElementById('targetUrl').textContent = fixedUrl;
                    document.querySelector('h1').textContent = customTitle;
                    document.querySelectorAll('p')[1].innerHTML = customMessage;
                    document.getElementById('extraContent').innerHTML = customExtraHTML;

                    if (debugMode) {
                        const debugInfo = document.createElement('div');
                        debugInfo.style.marginTop = '20px';
                        debugInfo.style.textAlign = 'left';
                        debugInfo.innerHTML = `
              <hr>
              <h3>ğŸ› ï¸ è°ƒè¯•ä¿¡æ¯ï¼š</h3>
              <p><strong>å½“å‰åŸŸåï¼š</strong> ${currentDomain}</p>
              <p><strong>ç›®æ ‡åŸŸåï¼š</strong> ${targetHostname}</p>
              <p><strong>æ˜¯å¦å†…ç½‘åœ°å€ï¼š</strong> ${isInternal}</p>
              <p><strong>é¡¶çº§åŸŸåæ˜¯å¦ç›¸åŒï¼š</strong> ${isSameTopLevel}</p>
              <p><strong>æ˜¯å¦å¼€å¯ debug æ¨¡å¼ï¼š</strong> ${debugMode}</p>
            `;
                        document.querySelector('.container').appendChild(debugInfo);
                    }

                    document.getElementById('confirmBtn').addEventListener('click', function () {
                        window.location.href = fixedUrl;
                    });

                    document.getElementById('cancelBtn').addEventListener('click', function () {
                        window.history.back();
                    });

                } catch (err) {
                    document.querySelector('.container').innerHTML = `
            <h1>é”™è¯¯</h1>
            <p>æ— æ•ˆçš„ç›®æ ‡é“¾æ¥ï¼š${targetUrl}</p>
            <pre>${err}</pre>
            <button onclick="window.history.back()">è¿”å›</button>
          `;
                }

            } else {
                document.querySelector('.container').innerHTML = `
          <h1>é”™è¯¯</h1>
          <p>æœªæ‰¾åˆ°ç›®æ ‡é“¾æ¥å‚æ•°ã€‚</p>
          <button onclick="window.history.back()">è¿”å›</button>
        `;
            }
        });
    </script>

    <!-- åŠ è½½æµ®åŠ¨æš—é»‘æ¨¡å¼æŒ‰é’® -->
    <script src="assets/scripts/darkmode-btn.js"></script>
    <script>
        createDarkModeButton();
    </script>
</body>

</html>